define(["talent","helpers/context"],function(Talent,Context){var $=Talent.$,xssFrame,IpFrame,ImgFrame;$.ajaxPrefilter(function(options){if(options.dataType!="jsonp"&&options.url.indexOf(BSGlobal.apiPath)==-1){options.xhr=function(){var url=options.url;if(url.indexOf("transfer")>0){var iframeWindow=IpFrame[0].contentWindow}else if(url.indexOf("beisencoding")>0){var iframeWindow=xssFrame[0].contentWindow}else if(url.indexOf("assistant")>0){var iframeWindow=ImgFrame[0].contentWindow}return iframeWindow.XMLHttpRequest?new iframeWindow.XMLHttpRequest:iframeWindow.ActiveXObject?new iframeWindow.ActiveXObject("Microsoft.XMLHTTP"):new iframeWindow.XMLHttpRequest}}options.headers=$.extend({},options.headers,{"x-referer":location.hash})});$.ajaxSetup({converters:{"* mock":true},headers:{"x-beisen-ajax":"1.0"},contentType:"application/x-www-form-urlencoded",statusCode:{401:function(response){login()},230:function(){Talent.app.vent.trigger("network:error",230)}}});$(document).on("ajaxSend",function(event,xhr,options){var UserInfo=Talent.Context.getCommonData();for(var key in UserInfo){if(!UserInfo[key]){delete UserInfo[key]}}var UserInfoStr=JSON.stringify(UserInfo);if(options.type.toLowerCase()=="get"){if(options.url.indexOf("?")>-1){options.url+="&userinfo="+UserInfoStr}else{options.url+="?userinfo="+UserInfoStr}}else{if(options.contentType!="application/x-www-form-urlencoded"){if(options.data){var oriData=JSON.parse(options.data);oriData.userinfo=UserInfo;options.data=JSON.stringify(oriData)}else{options.data=UserInfo}}else{if(options.data){options.data+="&userinfo="+UserInfoStr}else{options.data="userinfo="+UserInfoStr}}}});$.ajaxTransport("mock",function(options,originalOptions,jqXHR){return{send:function(headers,completeCallback){completeCallback(200,"success",{text:options.mockData[options.type]})}}});Backbone.emulateHTTP=true;var originalSync=Backbone.sync;Backbone.sync=function(method,model,options){if(method==="create"||method==="update"||method==="patch"){options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override","POST")}}if(model.mockData){options.dataType="mock";options.mockData=model.mockData}return originalSync.apply(Backbone,arguments)};function login(msg){msg=msg||"您的会话超时，请重新登录。\n点击“确定”后，自动转入登录页面。";if(confirm(msg)){location.href=Context.getLoginUrl();throw new Error("401")}}xssFrame=$('<iframe style="display:none" src="'+BSGlobal.repl+'/iframe.html"></iframe>');xssFrame.appendTo("body");IpFrame=$('<iframe style="display:none" src="'+BSGlobal.transfer+'/iframe.html"></iframe>');IpFrame.appendTo("body");ImgFrame=$('<iframe style="display:none" src="'+BSGlobal.assistantPath+'/iframe.html"></iframe>');ImgFrame.appendTo("body")});
//# sourceMappingURL=http://sourcemap.beisen.co/ux/tools-assessment/hotfix/app/scripts/network/index-1609071118.min.map